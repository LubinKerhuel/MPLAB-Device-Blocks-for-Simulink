<!doctype html><html lang=en><head><title>QEI - Quadrature Encoder Interface - MPLAB Device Blocks for Simulink</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="MPLAB Device Blocks for Simulink - Embedded Code Generation for dsPIC, PIC32, and SAM Microcontrollers"><meta name=keywords content="Microchip,MPLAB,MATLAB,Simulink,dsPIC,PIC32,Embedded,Code Generation,Motor Control"><meta name=author content="Microchip Technology Inc."><meta name=robots content="index, follow"><meta http-equiv=X-UA-Compatible content="IE=edge"><link rel=canonical href=https://mplab-blockset.github.io/MPLAB-Device-Blocks-for-Simulink/block_reference/encoders_counters/qei.html><link rel=icon type=image/x-icon href=../../favicon.ico><style>html,html[data-theme=dark],body{color-scheme:light only!important;background-color:#fff!important;color:#222!important}:root{--bg-primary:#f8f9fa;--bg-secondary:white;--bg-tertiary:#f8f9fa;--text-primary:#2c3e50;--text-secondary:#666;--text-tertiary:#6c757d;--text-heading:#1a1a1a;--border-color:#dee2e6;--border-light:#e1e8ed;--border-medium:#e9ecef;--accent-primary:#1C355E;--accent-secondary:#41B6E6;--accent-hover:#2a5a8f;--accent-light:#D1DDE6;--code-bg:#f4f4f4;--code-text:#c7254e;--pre-bg:linear-gradient(to bottom, #e8e8e8 0%, #f0f0f0 100%);--pre-border:#d0d0d0;--table-hover:#E5F3FF;--table-stripe:#f8f9fa;--note-bg:linear-gradient(to right, #e7f3fe 0%, #f5fbff 100%);--note-border:#2196F3;--note-text:#1976D2;--warning-bg:linear-gradient(to right, #fff9e6 0%, #fffcf0 100%);--warning-border:#ff9800;--warning-text:#f57c00;--shadow-sm:0 2px 4px rgba(0,0,0,0.05);--shadow-md:0 2px 8px rgba(0,0,0,0.08);--shadow-lg:0 2px 12px rgba(0,0,0,0.08)}[data-theme=dark]{--bg-primary:#1a1d23;--bg-secondary:#242831;--bg-tertiary:#2d3139;--text-primary:#e4e6eb;--text-secondary:#adb5bd;--text-tertiary:#8b95a1;--text-heading:#e4e6eb;--border-color:#3a3f4b;--border-light:#3a3f4b;--border-medium:#404654;--accent-primary:#41B6E6;--accent-secondary:#5AC8FA;--accent-hover:#6DD5FF;--accent-light:#1a2d3f;--code-bg:#2d3139;--code-text:#ff6b9d;--pre-bg:linear-gradient(to bottom, #2d3139 0%, #2d3139 100%);--pre-border:#3a3f4b;--table-hover:#1e3a52;--table-stripe:#2d3139;--note-bg:linear-gradient(to right, #1e3a52 0%, #1e3a52 100%);--note-border:#4da6d6;--note-text:#66b3e0;--warning-bg:linear-gradient(to right, #3d3520 0%, #3d3520 100%);--warning-border:#ffb347;--warning-text:#ffc870;--shadow-sm:0 2px 4px rgba(0,0,0,0.3);--shadow-md:0 2px 8px rgba(0,0,0,0.4);--shadow-lg:0 2px 12px rgba(0,0,0,0.5)}:root{--content-max-width:1000px;--content-margin-horizontal:30px;--content-margin-vertical:15px;--container-border-radius:8px}*{transition:background-color .3s ease,color .3s ease,border-color .3s ease}body{font-family:-apple-system,BlinkMacSystemFont,segoe ui,roboto,oxygen,ubuntu,cantarell,sans-serif;margin:0;padding:0;line-height:1.6;color:var(--text-primary);background-color:var(--bg-primary);font-size:15px}.doc-wrapper{display:flex;max-width:1600px;margin:0 auto;min-height:100vh}.sidebar{width:280px;background-color:var(--bg-secondary);border-right:1px solid var(--border-color);position:sticky;top:0;height:100vh;overflow-y:auto;overflow-x:hidden;flex-shrink:0}.sidebar::-webkit-scrollbar{width:8px}.sidebar::-webkit-scrollbar-track{background:var(--bg-tertiary)}.sidebar::-webkit-scrollbar-thumb{background:var(--border-color);border-radius:4px}.sidebar::-webkit-scrollbar-thumb:hover{background:var(--accent-primary)}.content-wrapper{flex:1;min-width:0;background-color:var(--bg-primary)}.container{max-width:var(--content-max-width);margin:var(--content-margin-vertical)var(--content-margin-horizontal);background-color:var(--bg-secondary);padding:30px;box-shadow:var(--shadow-lg);border-radius:var(--container-border-radius)}.sidebar-header{padding:20px;border-bottom:2px solid var(--border-light);background:linear-gradient(135deg,var(--accent-primary) 0%,var(--accent-secondary) 100%)}.sidebar-title{color:#fff;font-size:16px;font-weight:700;margin:0;text-align:center}.sidebar-nav{padding:15px 0}.nav-section{margin-bottom:8px}.nav-section-title{display:flex;align-items:center;justify-content:space-between;padding:10px 20px;color:var(--text-primary);font-weight:600;font-size:14px;cursor:pointer;border-left:3px solid transparent;transition:all .2s ease}.nav-section-title:hover{background-color:var(--bg-tertiary);border-left-color:var(--accent-primary);color:var(--accent-primary)}.nav-section-title .icon{font-size:16px;margin-right:8px}.nav-section-title .toggle-icon{font-size:12px;transition:transform .2s ease}.nav-section.expanded .toggle-icon{transform:rotate(90deg)}.nav-section-children{display:none;padding-left:15px}.nav-section.expanded>.nav-section-children{display:block}.nav-link{display:block;padding:8px 20px;padding-left:45px;color:var(--text-secondary);font-size:13px;text-decoration:none;border-left:3px solid transparent;transition:all .2s ease}.nav-link:hover{background-color:var(--bg-tertiary);color:var(--accent-primary);border-left-color:var(--accent-light)}.nav-link.active{background-color:var(--accent-light);color:var(--accent-primary);border-left-color:var(--accent-primary);font-weight:600}.nav-subsection{margin-bottom:4px}.nav-subsection-title{display:flex;align-items:center;justify-content:space-between;padding:8px 20px;padding-left:35px;color:var(--text-primary);font-weight:600;font-size:13px;cursor:pointer;border-left:3px solid transparent;transition:all .2s ease;background-color:var(--bg-tertiary)}.nav-subsection-title:hover{background-color:var(--bg-primary);border-left-color:var(--accent-secondary);color:var(--accent-secondary)}.nav-subsection-title .icon{font-size:14px;margin-right:6px}.nav-subsection-title .toggle-icon{font-size:10px;transition:transform .2s ease}.nav-subsection.expanded .toggle-icon{transform:rotate(90deg)}.nav-subsection .nav-section-children{display:none;padding-left:10px}.nav-subsection.expanded>.nav-section-children{display:block}.nav-block-link{display:block;padding:6px 20px;padding-left:55px;color:var(--text-secondary);font-size:12px;text-decoration:none;border-left:3px solid transparent;transition:all .2s ease}.nav-block-link:hover{background-color:var(--accent-light);color:var(--accent-primary);border-left-color:var(--accent-secondary)}.nav-block-link.active{background-color:var(--accent-light);color:var(--accent-primary);border-left-color:var(--accent-primary);font-weight:600}.mobile-nav-toggle{display:none;position:fixed;bottom:20px;right:20px;width:56px;height:56px;border-radius:50%;background:var(--accent-primary);color:#fff;border:none;font-size:24px;cursor:pointer;box-shadow:var(--shadow-lg);z-index:1000}.mobile-nav-toggle:hover{background:var(--accent-hover)}.theme-toggle{display:inline-flex;align-items:center;gap:6px;cursor:pointer;background:var(--bg-tertiary);border:1px solid var(--border-color);border-radius:20px;padding:6px 12px;font-size:13px;color:var(--text-secondary);margin-left:16px;user-select:none}.theme-toggle:hover{background:var(--accent-light);border-color:var(--accent-primary);color:var(--accent-primary)}.theme-icon{font-size:16px}.page-header{display:flex;justify-content:space-between;align-items:center;padding:16px 0 12px;margin-bottom:20px;border-bottom:3px solid var(--border-light);position:relative}.page-header::after{content:'';position:absolute;bottom:-3px;left:0;width:120px;height:3px;background:linear-gradient(90deg,var(--accent-primary),var(--accent-secondary))}.page-header h1{margin:0;color:var(--text-heading);font-size:32px;font-weight:700;letter-spacing:-.5px}.page-header-right{display:flex;align-items:center}.microchip-logo{height:40px;max-width:200px;object-fit:contain}.breadcrumbs{display:flex;align-items:center;font-size:13px;color:var(--text-secondary);margin-bottom:16px;padding:10px 14px;background:var(--bg-tertiary);border-radius:6px;border-left:3px solid var(--accent-primary)}.breadcrumbs a{color:var(--accent-primary);text-decoration:none;padding:4px 8px;border-radius:3px}.breadcrumbs a:hover{background-color:var(--accent-light);color:var(--accent-hover)}.breadcrumbs span{margin:0 8px;color:var(--text-tertiary)}h2{color:var(--text-heading);font-weight:600;font-size:22px;letter-spacing:-.5px;margin-top:32px;margin-bottom:12px;padding-bottom:6px;border-bottom:2px solid var(--border-light);position:relative}h2::before{content:'';position:absolute;bottom:-2px;left:0;width:60px;height:2px;background:linear-gradient(90deg,var(--accent-primary),var(--accent-secondary))}h3{color:var(--text-primary);font-weight:600;font-size:17px;margin-top:24px;margin-bottom:10px}h4{color:var(--text-primary);font-weight:500;font-size:15px;margin-top:18px;margin-bottom:8px}p{margin-bottom:12px;line-height:1.6;color:var(--text-primary)}table{border-collapse:separate;border-spacing:0;width:100%;margin:18px 0;border:1px solid var(--border-color);border-radius:6px;overflow:hidden;box-shadow:var(--shadow-md)}th{background:linear-gradient(to bottom,var(--accent-primary) 0%,var(--accent-secondary) 100%);color:#fff;padding:14px 16px;text-align:left;font-weight:600;font-size:13px;text-transform:uppercase;letter-spacing:.5px;border-bottom:2px solid var(--accent-secondary)}td{padding:12px 16px;border-bottom:1px solid var(--border-medium);vertical-align:top;color:var(--text-primary);background-color:var(--bg-secondary)}tr:last-child td{border-bottom:none}tr:nth-child(even) td{background-color:var(--table-stripe)}tbody tr:hover td{background-color:var(--table-hover)}code{background-color:var(--code-bg);padding:3px 6px;border-radius:3px;font-family:consolas,monaco,courier new,monospace;color:var(--code-text);font-size:14px}pre{background:var(--pre-bg);border:1px solid var(--pre-border);border-left:4px solid var(--accent-primary);border-radius:6px;padding:16px;margin:18px 0;box-shadow:var(--shadow-sm);overflow-x:auto;line-height:1.5}pre code{background-color:initial;padding:0;color:var(--text-primary);font-family:consolas,monaco,courier new,monospace;font-size:14px}.note{background:var(--note-bg);border-left:5px solid var(--note-border);border-radius:4px;padding:14px 16px;margin:18px 0;box-shadow:var(--shadow-md);position:relative}.note::before{content:'\2139\FE0F  Note';display:block;font-weight:600;color:var(--note-text);margin-bottom:6px;font-size:14px}.note p{color:var(--text-primary)}.warning{background:var(--warning-bg);border-left:5px solid var(--warning-border);border-radius:4px;padding:14px 16px;margin:18px 0;box-shadow:var(--shadow-md);position:relative}.warning::before{content:'\26A0\FE0F  Warning';display:block;font-weight:600;color:var(--warning-text);margin-bottom:6px;font-size:14px}.warning p{color:var(--text-primary)}ul,ol{margin:12px 0;padding-left:30px;line-height:1.6}li{margin:6px 0;color:var(--text-primary)}li mjx-container[display=true]{text-align:left!important;margin:8px 0!important}li p mjx-container[display=true]{text-align:left!important;margin:8px 0!important}a{color:var(--accent-primary);text-decoration:none}a:hover{color:var(--accent-hover);text-decoration:underline}.nav-footer{margin-top:48px;padding:20px 0 12px;border-top:2px solid var(--border-light);font-size:11px;color:var(--text-tertiary);text-align:center}.nav-footer p{margin:0;font-size:11px}.block-icon-container{display:flex;align-items:center;gap:15px;margin:20px auto;padding:15px;max-width:900px;background-color:#f8f9fa;border-radius:8px;border:1px solid #dee2e6;transition:all .2s ease-in-out}.block-card-link{display:flex;align-items:center;gap:15px;flex:1;text-decoration:none;color:inherit}.block-icon-container:has(.block-card-link):hover{background-color:#e9ecef;border-color:#0076a8;box-shadow:0 2px 8px rgba(0,118,168,.15);cursor:pointer}.block-icon-image{flex-shrink:0;width:150px;display:flex;flex-direction:column;align-items:center;justify-content:flex-start}.block-icon-image picture{width:100%;max-width:150px;display:flex;align-items:center;justify-content:center}.block-icon-image img,.block-icon-image source{max-width:100%;max-height:100%;width:auto;height:auto;display:block;object-fit:contain}.block-icon-description{flex:1;font-size:16px;line-height:1.6;color:#333;column-count:1;max-width:100%}.family-tags{display:flex;flex-wrap:wrap;gap:6px;margin-top:12px;justify-content:center;width:100%}.family-tag{display:inline-block;padding:3px 8px;font-size:11px;font-weight:600;background-color:#2196f3;color:#fff;border-radius:4px;white-space:nowrap}.family-detail{font-weight:400;opacity:.9;font-size:10px;margin-left:3px}.chip-family-badges{display:flex;flex-direction:column;gap:6px;padding:12px;background-color:#e3f2fd;border:2px solid #2196f3;border-radius:6px;min-width:140px;flex-shrink:0}.chip-family-badges::before{content:"Device Support";font-size:11px;font-weight:700;color:#1565c0;text-transform:uppercase;letter-spacing:.5px;margin-bottom:6px;text-align:center}.chip-badge{display:block;padding:6px 10px;font-size:12px;font-weight:600;border-radius:4px;white-space:nowrap;text-align:center;transition:all .15s ease-in-out}.chip-badge:hover{transform:scale(1.05);box-shadow:0 2px 4px rgba(0,0,0,.2)}.chip-badge.dspic30f{background-color:#e3f2fd;color:#1565c0;border:1px solid #90caf9}.chip-badge.dspic33f{background-color:#e8f5e9;color:#2e7d32;border:1px solid #81c784}.chip-badge.dspic33e{background-color:#fff3e0;color:#e65100;border:1px solid #ffb74d}.chip-badge.dspic33c{background-color:#f3e5f5;color:#6a1b9a;border:1px solid #ba68c8}.chip-badge.dspic33a{background-color:#fce4ec;color:#c2185b;border:1px solid #f06292}.chip-badge.pic32{background-color:#e0f7fa;color:#00695c;border:1px solid #4db6ac}.chip-badge.sam{background-color:#fff9c4;color:#f57f17;border:1px solid #fdd835}.chip-badge.all-families{background-color:#e0e0e0;color:#424242;border:1px solid #9e9e9e;font-weight:700}p img,.container>img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-light);border-radius:4px;box-shadow:var(--shadow-sm)}@media(max-width:768px){body{padding:10px 20px}.container{padding:20px}.page-header{flex-direction:column;align-items:flex-start;gap:16px}.microchip-logo{height:40px}.page-header h1{font-size:24px}h2{font-size:20px}h3{font-size:16px}}@media(max-width:1024px){.sidebar{position:fixed;left:-280px;top:0;height:100vh;z-index:999;transition:left .3s ease;box-shadow:2px 0 8px rgba(0,0,0,.15)}.sidebar.mobile-visible{left:0}.mobile-nav-toggle{display:flex;align-items:center;justify-content:center}.content-wrapper{width:100%}.container{margin:10px 15px;padding:20px}.sidebar.mobile-visible::after{content:'';position:fixed;top:0;left:280px;right:0;bottom:0;background:rgba(0,0,0,.5);z-index:-1}}@media(max-width:768px){.container{margin:10px;padding:15px}.page-header h1{font-size:22px}.breadcrumbs{font-size:12px;padding:8px 12px}.nav-section-title{font-size:13px;padding:8px 15px}.nav-link{font-size:12px;padding:6px 15px;padding-left:35px}}.under-construction-banner{background:linear-gradient(135deg,#ff9800 0%,#f57c00 100%);color:#fff;padding:12px 20px;text-align:center;font-size:14px;font-weight:600;border-bottom:3px solid #e65100;box-shadow:0 2px 8px rgba(0,0,0,.15);margin-bottom:20px}.under-construction-banner .icon{font-size:18px;margin-right:8px}.under-construction-banner strong{color:#fff;text-transform:uppercase;letter-spacing:.5px}</style><script type=application/ld+json>{"@context":"https://schema.org","@type":"TechArticle","name":"QEI - Quadrature Encoder Interface","description":"MPLAB Device Blocks for Simulink - Embedded Code Generation for dsPIC, PIC32, and SAM Microcontrollers","url":"https://mplab-blockset.github.io/MPLAB-Device-Blocks-for-Simulink\/block_reference\/encoders_counters\/qei.html","author":{"@type":"Organization","name":"Microchip Technology Inc."},"datePublished":"2025-10-16","dateModified":"2025-10-16","inLanguage":"en-US"}</script></head><body><div class=doc-wrapper><nav class=sidebar><div class=sidebar-header><h2 class=sidebar-title>MPLAB Blockset</h2></div><div class=sidebar-nav><div class=nav-section><a href=../../index.html class=nav-section-title style="display:block;border-left:3px solid transparent"><span><span class=icon>ğŸ </span>Home</span></a></div><div class=nav-section id=section-getting-started><a href=../../getting_started/index.html class=nav-section-title onclick='return event.stopPropagation(),toggleSection("getting-started"),!0'><span><span class=icon>ğŸš€</span>Getting Started</span>
<span class=toggle-icon onclick='return event.preventDefault(),event.stopPropagation(),toggleSection("getting-started"),!1'>â–¶</span></a><div class=nav-section-children><a href=../../getting_started/overview.html class=nav-link>Overview</a>
<a href=../../getting_started/installation.html class=nav-link>Installation</a>
<a href=../../getting_started/quick_start.html class=nav-link>Quick Start Guide</a>
<a href=../../getting_started/board_templates.html class=nav-link>Board Templates</a>
<a href=../../getting_started/motor_control_examples.html class=nav-link>Motor Control Examples</a>
<a href=../../getting_started/scheduler_multitasking.html class=nav-link>Scheduler & Multitasking</a>
<a href=../../getting_started/external_mode_pil.html class=nav-link>External Mode & PIL</a>
<a href=../../getting_started/data_visualization.html class=nav-link>Data Visualization</a>
<a href=../../getting_started/supported_devices.html class=nav-link>Supported Devices</a></div></div><div class=nav-section id=section-user-guide><a href=../../user_guide/index.html class=nav-section-title onclick='return event.stopPropagation(),toggleSection("user-guide"),!0'><span><span class=icon>ğŸ“š</span>User Guide</span>
<span class=toggle-icon onclick='return event.preventDefault(),event.stopPropagation(),toggleSection("user-guide"),!1'>â–¶</span></a><div class=nav-section-children><a href=../../user_guide/code_generation.html class=nav-link>Code Generation</a>
<a href=../../user_guide/compiler_setup.html class=nav-link>Compiler Setup</a>
<a href=../../user_guide/external_mode.html class=nav-link>External Mode</a>
<a href=../../user_guide/pil_testing.html class=nav-link>PIL Testing</a></div></div><div class=nav-section id=section-block-reference><a href=../../block_reference/index.html class=nav-section-title onclick='return event.stopPropagation(),toggleSection("block-reference"),!0'><span><span class=icon>ğŸ§©</span>Block Reference</span>
<span class=toggle-icon onclick='return event.preventDefault(),event.stopPropagation(),toggleSection("block-reference"),!1'>â–¶</span></a><div class=nav-section-children><div class=nav-subsection id=section-pwm><a href=../../block_reference/pwm_io/index.html class=nav-subsection-title onclick='return event.stopPropagation(),toggleSection("pwm"),!0'><span><span class=icon>âš¡</span>PWM</span>
<span class=toggle-icon onclick='return event.preventDefault(),event.stopPropagation(),toggleSection("pwm"),!1'>â–¶</span></a><div class=nav-section-children><a href=../../block_reference/pwm_io/pwm.html class=nav-block-link>PWM</a>
<a href=../../block_reference/pwm_io/pwm_highspeed.html class=nav-block-link>PWM High-Speed</a>
<a href=../../block_reference/pwm_io/pwm_hs_fep.html class=nav-block-link>PWM HS FEP</a>
<a href=../../block_reference/pwm_io/pwm_highspeed_override.html class=nav-block-link>PWM HS Override</a>
<a href=../../block_reference/pwm_io/mcpwm.html class=nav-block-link>MCPWM (PIC32)</a>
<a href=../../block_reference/pwm_io/pwm_sam7x.html class=nav-block-link>PWM SAM7x</a>
<a href=../../block_reference/pwm_io/pwm_sam7x_override.html class=nav-block-link>PWM SAM7x Override</a>
<a href=../../block_reference/pwm_io/tcc_pwm.html class=nav-block-link>TCC PWM (SAM)</a></div></div><div class=nav-subsection id=section-timers><a href=../../block_reference/timers/index.html class=nav-subsection-title onclick='return event.stopPropagation(),toggleSection("timers"),!0'><span><span class=icon>â±ï¸</span>Timers</span>
<span class=toggle-icon onclick='return event.preventDefault(),event.stopPropagation(),toggleSection("timers"),!1'>â–¶</span></a><div class=nav-section-children><a href=../../block_reference/timers/timer_config.html class=nav-block-link>Timer Config</a>
<a href=../../block_reference/timers/timer_pil_profiling.html class=nav-block-link>PIL Profiling Timer</a></div></div><div class=nav-subsection id=section-capture-compare><a href=../../block_reference/capture_compare/index.html class=nav-subsection-title onclick='return event.stopPropagation(),toggleSection("capture-compare"),!0'><span><span class=icon>ğŸ“</span>Input Capture / Output Compare</span>
<span class=toggle-icon onclick='return event.preventDefault(),event.stopPropagation(),toggleSection("capture-compare"),!1'>â–¶</span></a><div class=nav-section-children><a href=../../block_reference/capture_compare/input_capture.html class=nav-block-link>Input Capture</a>
<a href=../../block_reference/capture_compare/output_compare_hw.html class=nav-block-link>Output Compare (HW)</a>
<a href=../../block_reference/capture_compare/output_compare_sw.html class=nav-block-link>Output Compare (SW)</a></div></div><div class=nav-subsection id=section-adc><a href=../../block_reference/adc/index.html class=nav-subsection-title onclick='return event.stopPropagation(),toggleSection("adc"),!0'><span><span class=icon>ğŸ“Š</span>ADC</span>
<span class=toggle-icon onclick='return event.preventDefault(),event.stopPropagation(),toggleSection("adc"),!1'>â–¶</span></a><div class=nav-section-children><a href=../../block_reference/adc/adc.html class=nav-block-link>ADC (dsPIC)</a>
<a href=../../block_reference/adc/adc_hs_12b.html class=nav-block-link>ADC HS 12-bit</a>
<a href=../../block_reference/adc/adc_highspeed_sar.html class=nav-block-link>ADC High-Speed SAR</a>
<a href=../../block_reference/adc/adc_highspeed_sar_dspic.html class=nav-block-link>ADC HS SAR (dsPIC)</a>
<a href=../../block_reference/adc/adc_same5x.html class=nav-block-link>ADC (SAM E5x)</a>
<a href=../../block_reference/adc/adc_samrh707x.html class=nav-block-link>ADC (SAMRH707x)</a>
<a href=../../block_reference/adc/afec_sam7x.html class=nav-block-link>AFEC (SAM7x)</a></div></div><div class=nav-subsection id=section-communication><a href=../../block_reference/communication/index.html class=nav-subsection-title onclick='return event.stopPropagation(),toggleSection("communication"),!0'><span><span class=icon>ğŸ“¡</span>Communication</span>
<span class=toggle-icon onclick='return event.preventDefault(),event.stopPropagation(),toggleSection("communication"),!1'>â–¶</span></a><div class=nav-section-children><div class=nav-subsection id=section-uart><a href=../../block_reference/communication.html#uart-blocks class=nav-subsection-title onclick='return event.stopPropagation(),toggleSection("uart"),!0'><span><span class=icon></span>UART</span>
<span class=toggle-icon onclick='return event.preventDefault(),event.stopPropagation(),toggleSection("uart"),!1'>â–¶</span></a><div class=nav-section-children><a href=../../block_reference/communication/uart/uart_config.html class=nav-block-link>UART Config</a>
<a href=../../block_reference/communication/uart/uart_tx.html class=nav-block-link>UART Tx</a>
<a href=../../block_reference/communication/uart/uart_rx.html class=nav-block-link>UART Rx</a>
<a href=../../block_reference/communication/uart/uart_txmatlab.html class=nav-block-link>UART Tx MATLAB</a>
<a href=../../block_reference/communication/uart/uart_break_and_autobaud.html class=nav-block-link>UART Break & Autobaud</a></div></div><div class=nav-subsection id=section-can><a href=../../block_reference/communication.html#can-blocks class=nav-subsection-title onclick='return event.stopPropagation(),toggleSection("can"),!0'><span><span class=icon></span>CAN</span>
<span class=toggle-icon onclick='return event.preventDefault(),event.stopPropagation(),toggleSection("can"),!1'>â–¶</span></a><div class=nav-section-children><a href=../../block_reference/communication/can/can_config.html class=nav-block-link>CAN Config</a>
<a href=../../block_reference/communication/can/can_tx.html class=nav-block-link>CAN Tx</a>
<a href=../../block_reference/communication/can/can_rx.html class=nav-block-link>CAN Rx</a></div></div><a href=../../block_reference/communication/i2c.html class=nav-block-link>I2C Master/Slave</a>
<a href=../../block_reference/communication/spi.html class=nav-block-link>SPI Master/Slave</a></div></div><div class=nav-subsection id=section-digital-io><a href=../../block_reference/digital_io/index.html class=nav-subsection-title onclick='return event.stopPropagation(),toggleSection("digital-io"),!0'><span><span class=icon>ğŸ”Œ</span>Digital I/O</span>
<span class=toggle-icon onclick='return event.preventDefault(),event.stopPropagation(),toggleSection("digital-io"),!1'>â–¶</span></a><div class=nav-section-children><a href=../../block_reference/digital_io/digital_input.html class=nav-block-link>Digital Input</a>
<a href=../../block_reference/digital_io/digital_output.html class=nav-block-link>Digital Output</a>
<a href=../../block_reference/digital_io/digital_output_read.html class=nav-block-link>Digital Output Read</a>
<a href=../../block_reference/digital_io/digital_output_write.html class=nav-block-link>Digital Output Write</a></div></div><div class=nav-subsection id=section-encoders><a href=../../block_reference/encoders/index.html class=nav-subsection-title onclick='return event.stopPropagation(),toggleSection("encoders"),!0'><span><span class=icon>ğŸ”„</span>Encoders</span>
<span class=toggle-icon onclick='return event.preventDefault(),event.stopPropagation(),toggleSection("encoders"),!1'>â–¶</span></a><div class=nav-section-children><a href=../../block_reference/encoders_counters/qei.html class=nav-block-link>QEI (Quadrature Encoder)</a>
<a href=../../block_reference/encoders_counters/pdec.html class=nav-block-link>PDEC (SAM)</a>
<a href=../../block_reference/encoders_counters/qdec_samx.html class=nav-block-link>QDEC (SAM)</a>
<a href=../../block_reference/encoders_counters/change_notification.html class=nav-block-link>Change Notification</a></div></div><div class=nav-subsection id=section-analog-io><a href=../../block_reference/analog_io/index.html class=nav-subsection-title onclick='return event.stopPropagation(),toggleSection("analog-io"),!0'><span><span class=icon>ğŸ“‰</span>Analog I/O</span>
<span class=toggle-icon onclick='return event.preventDefault(),event.stopPropagation(),toggleSection("analog-io"),!1'>â–¶</span></a><div class=nav-section-children><a href=../../block_reference/analog_io/dac_samx.html class=nav-block-link>DAC (SAM)</a>
<a href=../../block_reference/analog_io/comparator_opamps_volt_ref/highspeed_analogcomparator.html class=nav-block-link>High-Speed Comparator</a>
<a href=../../block_reference/analog_io/comparator_opamps_volt_ref/highspeed_analogcomparator_wslope.html class=nav-block-link>Comparator w/ Slope</a>
<a href=../../block_reference/analog_io/comparator_opamps_volt_ref/op_amp.html class=nav-block-link>Op-Amp</a>
<a href=../../block_reference/analog_io/comparator_opamps_volt_ref/pga.html class=nav-block-link>PGA (Programmable Gain Amp)</a></div></div><div class=nav-subsection id=section-system-config><a href=../../block_reference/system_configuration/index.html class=nav-subsection-title onclick='return event.stopPropagation(),toggleSection("system-config"),!0'><span><span class=icon>âš™ï¸</span>System Config</span>
<span class=toggle-icon onclick='return event.preventDefault(),event.stopPropagation(),toggleSection("system-config"),!1'>â–¶</span></a><div class=nav-section-children><a href=../../block_reference/system_configuration/master.html class=nav-block-link>Master</a>
<a href=../../block_reference/system_configuration/interrupt.html class=nav-block-link>Interrupt</a>
<a href=../../block_reference/system_configuration/compiler_options.html class=nav-block-link>Compiler Options</a>
<a href=../../block_reference/system_configuration/scheduler_options.html class=nav-block-link>Scheduler Options</a>
<a href=../../block_reference/system_configuration/idle_task.html class=nav-block-link>Idle Task</a>
<a href=../../block_reference/system_configuration/mcu_load.html class=nav-block-link>MCU Load</a>
<a href=../../block_reference/system_configuration/mcu_overload.html class=nav-block-link>MCU Overload</a>
<a href=../../block_reference/system_configuration/tasks_state.html class=nav-block-link>Tasks State</a>
<a href=../../block_reference/system_configuration/secondary_core.html class=nav-block-link>Secondary Core</a></div></div><div class=nav-subsection id=section-utility><a href=../../block_reference/utility/index.html class=nav-subsection-title onclick='return event.stopPropagation(),toggleSection("utility"),!0'><span><span class=icon>ğŸ”§</span>Utility Blocks</span>
<span class=toggle-icon onclick='return event.preventDefault(),event.stopPropagation(),toggleSection("utility"),!1'>â–¶</span></a><div class=nav-section-children><a href=../../block_reference/user_functions/c_function_call.html class=nav-block-link>C Function Call</a>
<a href=../../block_reference/utility/doc.html class=nav-block-link>Documentation Block</a>
<a href=../../block_reference/utility/msi.html class=nav-block-link>MSI (Model Sample Info)</a>
<a href=../../block_reference/utility/port_info.html class=nav-block-link>Port Info</a>
<a href=../../block_reference/utility/timer_info.html class=nav-block-link>Timer Info</a>
<a href=../../block_reference/utility/simulink_reset_config.html class=nav-block-link>Simulink Reset Config</a></div></div></div></div><div class=nav-section id=section-examples><a href=../../examples/index.html class=nav-section-title onclick='return event.stopPropagation(),toggleSection("examples"),!0'><span><span class=icon>ğŸ“–</span>Examples</span>
<span class=toggle-icon onclick='return event.preventDefault(),event.stopPropagation(),toggleSection("examples"),!1'>â–¶</span></a><div class=nav-section-children><a href=../../examples/field_weakening.html class=nav-link>Field Weakening</a></div></div><div class=nav-section id=section-github><a href=https://github.com/microchip-technology/mplab-blocksetindex.html class=nav-section-title style="display:block;border-left:3px solid transparent"><span><span class=icon>ğŸ’»</span>GitHub</span></a></div></div></nav><div class=content-wrapper><div class=container><div class=breadcrumbs><a href=../../index.html>Home</a>
<span>></span>
<a href=../../block_reference/encoders/index.html>Encoder Blocks</a>
<span>></span>
<span>QEI - Quadrature Encoder Interface</span></div><div class=under-construction-banner><span class=icon>âš ï¸</span>
<strong>Documentation Under Construction</strong> â€”
This documentation is currently being developed. All information has not been validated by Microchip yet.</div><div class=page-header><h1>QEI - Quadrature Encoder Interface</h1><div class=page-header-right><img src=../../images/microchip-logo.png alt="Microchip Logo" class=microchip-logo>
<button class=theme-toggle onclick=toggleTheme() aria-label="Toggle dark mode">
<span class=theme-icon id=theme-icon>â˜€ï¸</span>
<span id=theme-text>Light</span></button></div></div><div class=block-icon-container><div class=block-icon-image><picture><source srcset=../../images/blocks/digital/QEI.svg type=image/svg+xml><source srcset=../../images/blocks/digital/QEI_hu_a8e4c27744a4f455.webp type=image/webp><img src=../../images/blocks/digital/QEI.png alt="QEI Block Icon"></picture></div><div class=block-icon-description>Quadrature Encoder Interface - Position and Velocity Measurement</div></div><h2 id=overview>Overview</h2><p>The MCHP_QEI block provides an interface to the Quadrature Encoder Interface (QEI) peripheral available on dsPIC and PIC32 microcontrollers. This peripheral decodes quadrature encoder signals to measure position, direction, and velocity of rotating shafts, making it ideal for motor control and precision positioning applications.
<strong>Key Features:</strong></p><ul><li>Quadrature decoding (X2 and X4 modes)</li><li>16-bit or 32-bit position counter</li><li>Index pulse detection and position reset</li><li>Direction sensing</li><li>Programmable digital filtering</li><li>Velocity measurement (32-bit QEI only)</li><li>Multiple operating modes: encoder, pulse counter, up/down counter</li><li>Position modulo and reset options</li></ul><h3 id=device-support>Device Support</h3><table><thead><tr><th>Family</th><th>QEI Type</th><th>Max Modules</th><th>Features</th></tr></thead><tbody><tr><td>dsPIC30F</td><td>16-bit</td><td>1-2</td><td>Basic quadrature decoding, index reset</td></tr><tr><td>dsPIC33F</td><td>16-bit</td><td>1-2</td><td>Basic quadrature decoding, index reset</td></tr><tr><td>dsPIC33E</td><td>32-bit</td><td>1-2</td><td>Extended position counter, velocity measurement</td></tr><tr><td>dsPIC33C</td><td>32-bit</td><td>1-2</td><td>Extended position counter, velocity measurement</td></tr><tr><td>dsPIC33A</td><td>32-bit</td><td>1-2</td><td>Enhanced position/velocity, advanced filtering</td></tr><tr><td>PIC32MK</td><td>32-bit</td><td>1-2</td><td>Extended features, modulo with index reset</td></tr></tbody></table><h2 id=block-parameters>Block Parameters</h2><h3 id=operating-mode>Operating Mode</h3><table><thead><tr><th>Parameter</th><th>Options</th><th>Description</th></tr></thead><tbody><tr><td>QEI Mode</td><td>â€¢ Quadrature Encoder</td><td>â€¢ External Pulse Counter</td></tr><tr><td>X2/X4 Mode</td><td>on/off (16-bit QEI only)</td><td>X2: 2 counts/line, X4: 4 counts/line</td></tr></tbody></table><h3 id=position-counter-configuration>Position Counter Configuration</h3><table><thead><tr><th>Parameter</th><th>Options</th><th>Description</th></tr></thead><tbody><tr><td>Position Output</td><td>â€¢ is not an output</td><td>â€¢ 16-bit unsigned</td></tr><tr><td>Position Reset Mode</td><td>â€¢ Never reset</td><td>â€¢ Reset on INDEX</td></tr><tr><td>Modulo Limits</td><td>[Low High] vector</td><td>Position counter modulo boundaries</td></tr><tr><td>Initial Value</td><td>Integer</td><td>Position initialization value</td></tr></tbody></table><h3 id=index-pulse-configuration>Index Pulse Configuration</h3><table><thead><tr><th>Parameter</th><th>Options</th><th>Description</th></tr></thead><tbody><tr><td>Index Counter Output</td><td>â€¢ is not an output</td><td>â€¢ 16-bit unsigned/signed</td></tr><tr><td>Index Match Value</td><td>QEA/QEB state (00, 01, 10, 11)</td><td>Encoder state when index is valid</td></tr><tr><td>Index Polarity</td><td>Active high/low</td><td>Index pulse polarity</td></tr></tbody></table><h3 id=velocity-measurement-32-bit-qei>Velocity Measurement (32-bit QEI)</h3><table><thead><tr><th>Parameter</th><th>Options</th><th>Description</th></tr></thead><tbody><tr><td>Velocity Output</td><td>â€¢ is not an output</td><td>â€¢ 16-bit unsigned</td></tr><tr><td>Period Output</td><td>â€¢ is not an output</td><td>â€¢ 16-bit unsigned</td></tr><tr><td>Max Period</td><td>Time (seconds)</td><td>Maximum period for velocity calculation</td></tr></tbody></table><h3 id=signal-conditioning>Signal Conditioning</h3><table><thead><tr><th>Parameter</th><th>Options</th><th>Description</th></tr></thead><tbody><tr><td>Digital Filter</td><td>on/off</td><td>Enable input signal filtering</td></tr><tr><td>Filter Cutoff Freq</td><td>Frequency (Hz)</td><td>Low-pass filter cutoff frequency</td></tr><tr><td>Swap QEA/QEB</td><td>on/off</td><td>Reverse encoder direction</td></tr><tr><td>Invert Polarity</td><td>QEA, QEB, INDEX, HOME</td><td>Invert input signal polarity</td></tr></tbody></table><h3 id=pin-configuration-remappable-devices>Pin Configuration (Remappable Devices)</h3><table><thead><tr><th>Pin</th><th>Function</th><th>Description</th></tr></thead><tbody><tr><td>QEA/QEIA</td><td>Phase A Input</td><td>Encoder channel A (or pulse input)</td></tr><tr><td>QEB/QEIB</td><td>Phase B Input</td><td>Encoder channel B (or direction input)</td></tr><tr><td>INDEX/QEINDX</td><td>Index Input</td><td>Index pulse for position reset</td></tr><tr><td>HOME/QEIHOM</td><td>Home Input</td><td>Home reference signal (optional)</td></tr></tbody></table><h2 id=quadrature-encoding-principles>Quadrature Encoding Principles</h2><h3 id=x4-quadrature-decoding>X4 Quadrature Decoding</h3><p>In X4 mode, the QEI peripheral counts on both rising and falling edges of both channels, providing 4 counts per encoder line:
QEA <em><strong>â”Œâ”€â”€â”€â”</strong></em>â”Œâ”€â”€â”€â”<em><strong>â”Œâ”€â”€â”€â”</strong></em>â”Œâ”€â”€â”€â”___ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ QEB <em><strong><em><strong>â”Œâ”€â”€â”€â”</strong></em>â”Œâ”€â”€â”€â”</strong></em>â”Œâ”€â”€â”€â”___â”Œâ”€â”€â”€ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ ____â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€ Count: 0 1 2 3 4 5 6 7 8 9 10 11 12 Direction: FORWARD (QEA leads QEB by 90Â°)</p><h3 id=x2-quadrature-decoding-16-bit-qei>X2 Quadrature Decoding (16-bit QEI)</h3><p>In X2 mode, only one edge per channel is counted, providing 2 counts per encoder line:
QEA <em><strong>â”Œâ”€â”€â”€â”</strong></em>â”Œâ”€â”€â”€â”<em><strong>â”Œâ”€â”€â”€â”</strong></em>â”Œâ”€â”€â”€â”___ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ Count: 0 1 2 3 4 5 6 (Rising edges of QEA when in X2 mode)</p><h3 id=index-pulse-operation>Index Pulse Operation</h3><p>The index pulse provides absolute position reference. It can reset the position counter when specific conditions are met:
QEA â”Œâ”€â”<em>â”Œâ”€â”</em>â”Œâ”€â”<em>â”Œâ”€â”</em>â”Œâ”€â”<em>â”Œâ”€â”</em>â”Œâ”€â”<em>â”Œâ”€â”</em> â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ QEB __â”Œâ”€â”<em>â”Œâ”€â”</em>â”Œâ”€â”<em>â”Œâ”€â”</em>â”Œâ”€â”<em>â”Œâ”€â”</em>â”Œâ”€â”_â”Œâ”€â” INDEX ______<strong><strong><strong><strong><strong>â”Œâ”€â”€â”€â”€â”€â”€â”</strong></strong></strong></strong></strong> â”‚ â”‚ Position: &mldr; â†’ 47 â†’ 48 â†’ 0 â†’ 1 â†’ 2 â†’ &mldr; â†‘ Reset on INDEX</p><h2 id=key-registers-dspic>Key Registers (dsPIC)</h2><h3 id=16-bit-qei-registers-dspic30f33f>16-bit QEI Registers (dsPIC30F/33F)</h3><p>// QEI Control Register QEICONbits.QEIM = 0b110; // X4 mode, reset on index match QEICONbits.POSRES = 1; // Index pulse resets position QEICONbits.SWPAB = 0; // No swap of QEA/QEB QEICONbits.TQCS = 0; // Internal clock QEICONbits.UPDN = 1; // Direction (read-only)// Position Counter POSCNT = 0; // Current position MAXCNT = 1999; // Modulo at 2000 (500 PPR Ã— 4)// Digital Filter Control DFLTCONbits.QECK = 0b100; // Clock divider for filter DFLTCONbits.QEOUT = 1; // Enable digital filter</p><h3 id=32-bit-qei-registers-dspic33e33c33a>32-bit QEI Registers (dsPIC33E/33C/33A)</h3><p>// QEI Control Register QEICONbits.QEIEN = 1; // Enable QEI QEICONbits.PIMOD = 0b110; // Modulo count mode QEICONbits.IMV = 0b11; // Index match: QEA=1, QEB=1 QEICONbits.INTDIV = 0b011; // Velocity timer prescaler QEICONbits.CCM = 0b00; // Quadrature encoder mode// Position Counter (32-bit) POSCNTH = 0; // Position high word POSCNTL = 0; // Position low word// Modulo Limits QEILEC = 0; // Lower limit (32-bit) QEIGEC = 1999; // Upper limit (32-bit)// I/O Control Register QEIOCbits.SWPAB = 0; // Swap QEA/QEB QEIOCbits.OUTFNC = 0b00; // No output function QEIOCbits.QFDIV = 0b100; // Digital filter clock divider QEIOCbits.FLTREN = 1; // Enable digital filter// Velocity/Period Capture VELCNT = &mldr;; // Position delta (velocity) INTCNT = &mldr;; // Period counter</p><h3 id=pic32mk-qei-registers>PIC32MK QEI Registers</h3><p>// Similar to dsPIC33E with additional features: QEICONbits.PIMOD = 0b111; // Modulo + index reset (MK only)</p><h2 id=examples>Examples</h2><h3 id=example-1-500-ppr-incremental-encoder-x4-mode>Example 1: 500 PPR Incremental Encoder (X4 Mode)</h3><h4 id=application-bldc-motor-position-control>Application: BLDC Motor Position Control</h4><p><strong>Hardware:</strong> 500 PPR (Pulses Per Revolution) incremental encoder</p><p><strong>Configuration:</strong></p><ul><li>QEI Mode: Quadrature Encoder (X4)</li><li>Position Output: 16-bit signed</li><li>Position Reset: Modulo between [0, 1999]</li><li>Digital Filter: 50 kHz cutoff</li></ul><p><strong>Resolution Calculation:</strong>
// 500 PPR Ã— 4 (X4 mode) = 2000 counts/revolution Counts_per_rev = 500 * 4 = 2000; Degrees_per_count = 360 / 2000 = 0.18Â°; Radians_per_count = 2<em>Ï€ / 2000 = 0.00314 rad; // In Simulink/MATLAB Position_rad = QEI_Position * (2</em>pi/2000); Position_deg = QEI_Position * 0.18; <strong>Note:</strong> Set modulo limits to [0, 1999] so position wraps at 2000 counts (one full revolution). For signed output, use [-1000, 999] for symmetric range.</p><h3 id=example-2-velocity-measurement-from-position-difference>Example 2: Velocity Measurement from Position Difference</h3><h4 id=application-motor-speed-feedback>Application: Motor Speed Feedback</h4><p><strong>Method 1: Position Difference (Simple)</strong>
// Simulink blocks: QEI Position â†’ [Unit Delay] â†’ Subtract â†’ Velocity (counts/sample) â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ // Convert to RPM (1 kHz sample rate, 2000 counts/rev) Velocity_RPM = (Position - Position_z) * (1000 samples/s) * (60 s/min) / (2000 counts/rev) Velocity_RPM = Velocity_counts * 30
<strong>Method 2: Period Measurement (32-bit QEI, Better at Low Speed)</strong>
// Use QEI period output Period_Output: 32-bit unsigned Max_Period: 0.1 seconds // Period in timer ticks, convert to RPM Velocity_RPM = (60 / Max_Period) / (Period_ticks / QEI_max) <strong>Tip:</strong> Position difference method works well at high speeds. Period measurement (INTCNT) is better for low speeds where counts are infrequent.</p><h3 id=example-3-index-referenced-absolute-position>Example 3: Index-Referenced Absolute Position</h3><h4 id=application-multi-turn-absolute-position-with-index-pulse>Application: Multi-Turn Absolute Position with Index Pulse</h4><p><strong>Configuration:</strong></p><ul><li>Position Output: 16-bit unsigned (0-1999)</li><li>Index Counter Output: 16-bit signed (revolution counter)</li><li>Position Reset: Reset on INDEX event</li><li>Index Match: QEA=1, QEB=1
// Absolute position calculation: Absolute_Position_counts = (Revolution_Count * 2000) + Position_Within_Rev; // In degrees: Absolute_Position_deg = Absolute_Position_counts * 0.18; // Example: After 3.5 revolutions from index Revolution_Count = 3; Position_Within_Rev = 1000; // Halfway through 4th revolution Absolute_Position_counts = (3 * 2000) + 1000 = 7000 counts Absolute_Position_deg = 7000 * 0.18 = 1260Â° <strong>Index Homing Procedure:</strong></li><li>Power on: position and revolution counters are undefined</li><li>Rotate motor until first index pulse â†’ counters reset to 0</li><li>Now position is referenced to index</li><li>Multi-turn position = (revolution Ã— 2000) + position</li></ul><h3 id=example-4-external-pulse-counter-with-direction>Example 4: External Pulse Counter with Direction</h3><h4 id=application-conveyor-belt-position-tracking>Application: Conveyor Belt Position Tracking</h4><p><strong>Hardware:</strong> Proximity sensor generates pulses, separate direction signal</p><p><strong>Configuration:</strong></p><ul><li>QEI Mode: External Pulse Counter with Direction</li><li>QEA Pin: Pulse input (proximity sensor)</li><li>QEB Pin: Direction input (forward/reverse)</li><li>Position Output: 32-bit signed
// Wiring:// QEA â† Proximity sensor pulses (1 pulse per 10 mm)// QEB â† Direction: HIGH = forward, LOW = reverse// Position in millimeters: Position_mm = QEI_Position * 10; // Velocity in mm/s (1 kHz sample): Velocity_mm_s = (Position - Position_prev) * 10 * 1000;</li></ul><h2 id=troubleshooting>Troubleshooting</h2><h3 id=common-issues-and-solutions>Common Issues and Solutions</h3><h4 id=issue-position-counter-counts-backward>Issue: Position Counter Counts Backward</h4><p><strong>Cause:</strong> Encoder wiring reversed (QEA and QEB swapped)</p><p><strong>Solution:</strong> Enable &ldquo;Swap QEA/QEB&rdquo; parameter, or physically swap encoder wires</p><h4 id=issue-noisy-position-reading-jumpsjitter>Issue: Noisy Position Reading (Jumps/Jitter)</h4><p><strong>Cause:</strong> Electrical noise on encoder signals</p><p><strong>Solutions:</strong></p><ul><li>Enable digital filter with appropriate cutoff frequency (set to 1/2 of max encoder frequency)</li><li>Use shielded cable for encoder wiring</li><li>Add external RC filter on encoder inputs</li><li>Check encoder power supply quality</li></ul><h4 id=issue-missed-counts-at-high-speed>Issue: Missed Counts at High Speed</h4><p><strong>Cause:</strong> Encoder frequency exceeds QEI peripheral maximum input frequency</p><p><strong>Solutions:</strong></p><ul><li>Reduce digital filter cutoff frequency (increases max input frequency)</li><li>Check encoder frequency: Max_freq = (MCU_freq / Filter_divider) / 2</li><li>For 70 MIPS dsPIC33: with QFDIV=3, max freq â‰ˆ 11.7 MHz / 6 = 1.95 MHz</li><li>Consider using lower resolution encoder or gear reduction</li></ul><h4 id=issue-index-pulse-not-detected>Issue: Index Pulse Not Detected</h4><p><strong>Causes and Solutions:</strong></p><ul><li>Check INDEX pin wiring and polarity</li><li>Verify &ldquo;Index Match Value&rdquo; corresponds to encoder state when index is active</li><li>Ensure index pulse width is sufficient (minimum 1 QEI clock cycle)</li><li>Check that encoder is rotating through the index position</li></ul><h4 id=issue-position-overflowunderflow>Issue: Position Overflow/Underflow</h4><p><strong>Cause:</strong> Position exceeds selected datatype range</p><p><strong>Solutions:</strong></p><ul><li>Use larger datatype (32-bit instead of 16-bit)</li><li>Use signed datatype for bidirectional motion</li><li>Enable modulo mode to wrap position at defined boundaries</li><li>Use revolution counter for multi-turn applications</li></ul><h3 id=filter-cutoff-frequency-selection>Filter Cutoff Frequency Selection</h3><p>// Rule of thumb for filter selection: Max_Encoder_Freq = Max_RPM * (Counts_per_Rev / 60); Filter_Cutoff = Max_Encoder_Freq * 2; // Nyquist criterion// Example: 3000 RPM motor with 500 PPR encoder (X4 = 2000 counts/rev) Max_Encoder_Freq = 3000 * (2000 / 60) = 100 kHz Filter_Cutoff = 100 kHz * 2 = 200 kHz // Select â‰¥ 200 kHz filter</p><h2 id=performance-considerations>Performance Considerations</h2><h3 id=maximum-encoder-frequency>Maximum Encoder Frequency</h3><p>The maximum encoder input frequency depends on the device clock and filter settings:
// For dsPIC33E/33C at 70 MIPS (140 MHz SYSCLK) QEI_Clock = 140 MHz; Filter_Divider = [1 2 4 8 16 32 64 256] * 3; // Actual divider values// Maximum input frequency: Max_Input_Freq = QEI_Clock / (Filter_Divider * 2); // Examples:// QFDIV=0 (Ã·3): Max = 140M / (3<em>2) = 23.3 MHz// QFDIV=1 (Ã·6): Max = 140M / (6</em>2) = 11.7 MHz// QFDIV=7 (Ã·768): Max = 140M / (768*2) = 91 kHz</p><h3 id=velocity-measurement-resolution>Velocity Measurement Resolution</h3><p>For 32-bit QEI with period measurement:
// Period counter resolution: Timer_Prescaler = [1 2 4 8 16 32 64 256]; // INTDIV settings Timer_Frequency = QEI_Clock / Timer_Prescaler; Period_Resolution = 1 / Timer_Frequency; // Velocity range: Max_Velocity = 1 / (Period_Resolution); Min_Velocity = 1 / (Period_Resolution * 65535); // 16-bit counter// Example with INTDIV=4 (Ã·8) at 140 MHz: Period_Resolution = 1 / (140M / 8) = 57.1 ns Max_Velocity = 17.5 MHz Min_Velocity = 267 Hz</p><h3 id=interrupt-latency>Interrupt Latency</h3><p>When using QEI interrupts for index detection or position limits:
<strong>Interrupt Response Time:</strong></p><ul><li>Typical latency: 10-20 instruction cycles</li><li>At 70 MIPS: ~140-280 ns interrupt response</li><li>Index position accuracy: Â±1-2 encoder counts at maximum speed</li><li>For precise index homing: use index match value (IMV) instead of interrupt</li></ul><h2 id=related-blocks>Related Blocks</h2><ul><li><a href=../encoders_counters/qdec_samx.html><strong>MCHP_QDEC_SAMx</strong></a> - Quadrature Decoder for SAM devices</li><li><a href=../encoders_counters/pdec.html><strong>MCHP_PDEC</strong></a> - Position Decoder for SAM E5x/E7x (Hall sensors, stepper)</li><li><a href=../digital_io/change_notification.html><strong>MCHP_CN</strong></a> - Change Notification (pin interrupt, can be used for simple encoders)</li><li><a href=../timers/input_capture.html><strong>MCHP_IC</strong></a> - Input Capture (alternative for encoder pulse timing)</li></ul><h2 id=references>References</h2><ul><li><strong>dsPIC30F/33F Family Reference Manual</strong> - Section 15: Quadrature Encoder Interface</li><li><strong>dsPIC33E/33C Family Reference Manual</strong> - Section 15: QEI ([DS70601B])</li><li><strong>dsPIC33A Family Reference Manual</strong> - Section 15: QEI Module</li><li><strong>PIC32MK Family Reference Manual</strong> - Section 22: QEI</li><li><strong>[AN1078]:</strong> Sensorless Field Oriented Control (Application Note using QEI)</li><li><strong>[AN1162]:</strong> Sensored FOC for PMSM/BLDC (QEI-based motor control)</li></ul><p>Last Updated: 2024 | MCHP Blockset for MATLAB/Simulink</p><h2 id=see-also>See Also</h2><h3 id=application-notes>Application Notes</h3><ul><li><a href=https://www.microchip.com/AN1078>AN1078 - Sensorless Field-Oriented Control of a PMSM</a></li><li><a href=https://www.microchip.com/AN1162>AN1162 - Sensorless Field-Oriented Control of PMSM Motors</a></li></ul><h3 id=datasheets>Datasheets</h3><ul><li><a href=https://www.microchip.com/DS70601B>QEI Module Family Reference Manual (DS70601B)</a></li></ul><div class=nav-footer><p>Last updated: October 2025 | MPLAB Blockset Documentation</p><p>&copy; 2025 Microchip Technology Incorporated and its subsidiaries</p><p style=font-size:10px;margin-top:8px;line-height:1.4>The "Microchip" name and logo, the "M" logo, and other names, logos, and brands are registered
and unregistered trademarks of Microchip Technology Incorporated or its affiliates and/or
subsidiaries in the United States and/or other countries ("Microchip Trademarks"). Information
regarding Microchip Trademarks can be found at
<a href=https://www.microchip.com/en-us/about/legal-information/microchip-trademarks target=_blank style=color:var(--accent-primary)>https://www.microchip.com/en-us/about/legal-information/microchip-trademarks</a>.</p></div></div></div><button class=mobile-nav-toggle onclick=toggleMobileSidebar() aria-label="Toggle navigation">
â˜°</button></div><script>function toggleTheme(){const t=document.documentElement,n=t.getAttribute("data-theme"),e=n==="dark"?"light":"dark";t.setAttribute("data-theme",e),localStorage.setItem("theme",e),updateThemeButton(e)}function updateThemeButton(e){const t=document.getElementById("theme-icon"),n=document.getElementById("theme-text");e==="dark"?(t.textContent="ğŸŒ™",n.textContent="Dark"):(t.textContent="â˜€ï¸",n.textContent="Light")}(function(){const n=localStorage.getItem("theme"),s=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,t=n||(s?"dark":"light");document.documentElement.setAttribute("data-theme",t),updateThemeButton(t)})(),window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{if(!localStorage.getItem("theme")){const t=e.matches?"dark":"light";document.documentElement.setAttribute("data-theme",t),updateThemeButton(t)}}),window.toggleSection=function(e){const t=document.getElementById("section-"+e);if(t&&(t.classList.toggle("expanded"),t.classList.contains("nav-section"))){const n=getExpandedSections();t.classList.contains("expanded")?n.add(e):n.delete(e),localStorage.setItem("expandedSections",JSON.stringify([...n]))}};function getExpandedSections(){const e=localStorage.getItem("expandedSections");return new Set(e?JSON.parse(e):[])}function restoreExpandedSections(){const e=getExpandedSections();e.forEach(e=>{const t=document.getElementById("section-"+e);t&&t.classList.add("expanded")})}function highlightActivePage(){const e=window.location.pathname,t=document.querySelectorAll(".nav-link, .nav-block-link, .nav-section-title[href], .nav-subsection-title[href]");t.forEach(t=>{const n=new URL(t.href,window.location.origin).pathname;if(n===e){t.classList.add("active");const n=t.closest(".nav-subsection");n&&!n.classList.contains("expanded")&&n.classList.add("expanded");const e=t.closest(".nav-section");if(e&&!e.classList.contains("expanded")){e.classList.add("expanded");const n=e.id.replace("section-",""),t=getExpandedSections();t.add(n),localStorage.setItem("expandedSections",JSON.stringify([...t]))}}})}window.toggleMobileSidebar=function(){const e=document.querySelector(".sidebar");e&&e.classList.toggle("mobile-visible")},function(){restoreExpandedSections(),highlightActivePage();const t=document.querySelector(".nav-link.active");if(t){const e=t.closest(".nav-section");if(e&&e.id){const n=e.id.replace("section-",""),t=getExpandedSections();t.has(n)||(t.add(n),localStorage.setItem("expandedSections",JSON.stringify([...t])))}}}()</script></body></html>